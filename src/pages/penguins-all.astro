---
import Layout from "../layouts/Layout.astro";
import PlotFigure from "../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import penguinsRaw from "../assets/penguins.json";

/** transforme la donnée (nombres) */
const tidy = (rows) =>
  rows
    .filter(d => d.culmen_length_mm != null && d.culmen_depth_mm != null)
    .map(d => ({
      ...d,
      culmen_length_mm: +d.culmen_length_mm,
      culmen_depth_mm: +d.culmen_depth_mm
    }));

/** options Plot pour un scatter par espèce */
const makeOptions = (rows, title) => ({
  width: 860,
  height: 480,
  marks: [
    Plot.dot(rows, {
      x: "culmen_length_mm",
      y: "culmen_depth_mm",
      stroke: "species",
      fill: "species",
      r: 3.5,
      tip: true
    })
  ],
  x: { label: "Culmen length (mm)", grid: true },
  y: { label: "Culmen depth (mm)", grid: true },
  color: { legend: true },
  caption: title
});

---

<Layout title="TP6 — Penguins (toutes les espèces)">
  <nav class="mb-4 flex gap-2 text-sm">
    {species.map(s => <a href={`#${s}`} class="px-3 py-1 rounded border">{s}</a>)}
  </nav>

  {charts.map(({s, options}) => (
    <section id={s} class="mb-10">
      <h2 class="text-xl font-semibold mb-2">{s}</h2>
      <PlotFigure options={options} />
    </section>
  ))}
</Layout>
